# YesLocker ç¯å¢ƒå˜é‡é…ç½®æŒ‡å—

## ğŸ” ç¯å¢ƒå˜é‡æ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† YesLocker ç³»ç»Ÿåœ¨ä¸åŒç¯å¢ƒä¸‹éœ€è¦é…ç½®çš„ç¯å¢ƒå˜é‡ã€‚

## ğŸ“¦ å¼€å‘ç¯å¢ƒ (Development)

### ç”¨æˆ·ç«¯ (User App)

åˆ›å»º `.env.local` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼š

```bash
# APIé…ç½®
VITE_API_BASE_URL=http://localhost:3001
VITE_APP_TITLE=YesLockerå¼€å‘ç‰ˆ

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_MOCK=false
VITE_DEBUG_MODE=true
```

### ç®¡ç†ç«¯ (Admin Panel)

åˆ›å»º `admin/.env.local` æ–‡ä»¶ï¼š

```bash
# APIé…ç½®
VITE_API_BASE_URL=http://localhost:3001
VITE_APP_TITLE=YesLockerç®¡ç†ç«¯å¼€å‘ç‰ˆ

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_MOCK=false
VITE_DEBUG_MODE=true
```

### APIæœåŠ¡å™¨ (Server)

åˆ›å»º `server/.env` æ–‡ä»¶ï¼š

```bash
# æœåŠ¡å™¨é…ç½®
PORT=3001
NODE_ENV=development

# æ•°æ®åº“é…ç½®ï¼ˆPostgreSQLï¼‰
DATABASE_URL=postgresql://username:password@localhost:5432/yeslocker

# JWTé…ç½®
JWT_SECRET=your-development-jwt-secret
JWT_EXPIRES_IN=7d

# CORSé…ç½®
CORS_ORIGIN=http://localhost:3000,http://localhost:3002

# çŸ­ä¿¡æœåŠ¡é…ç½®ï¼ˆè…¾è®¯äº‘ï¼‰
TENCENT_SECRET_ID=your-tencent-secret-id
TENCENT_SECRET_KEY=your-tencent-secret-key
TENCENT_SMS_APP_ID=your-sms-app-id
TENCENT_SMS_SIGN_NAME=YesLocker
TENCENT_SMS_TEMPLATE_ID=your-template-id

# æµ‹è¯•æ¨¡å¼
TEST_MODE=true
TEST_SMS_CODE=123456
```

## ğŸš€ ç”Ÿäº§ç¯å¢ƒ (Production - Railway)

### Railway å¹³å°ç¯å¢ƒå˜é‡è®¾ç½®

#### 1. API æœåŠ¡ (yeslocker-api)

åœ¨ Railway çš„ API æœåŠ¡è®¾ç½®ä¸­æ·»åŠ ï¼š

```bash
# åŸºç¡€é…ç½®
NODE_ENV=production
PORT=3001

# æ•°æ®åº“ï¼ˆRailwayè‡ªåŠ¨æ³¨å…¥ï¼‰
DATABASE_URL=(Railwayä¼šè‡ªåŠ¨æä¾›)

# JWTé…ç½®
JWT_SECRET=your-super-secure-production-jwt-secret
JWT_EXPIRES_IN=7d

# CORSé…ç½®
CORS_ORIGIN=https://app.yes147.net,https://admin.yes147.net

# çŸ­ä¿¡æœåŠ¡é…ç½®
TENCENT_SECRET_ID=your-production-tencent-secret-id
TENCENT_SECRET_KEY=your-production-tencent-secret-key
TENCENT_SMS_APP_ID=your-production-sms-app-id
TENCENT_SMS_SIGN_NAME=YesLocker
TENCENT_SMS_TEMPLATE_ID=your-production-template-id

# ç”Ÿäº§æ¨¡å¼å…³é—­æµ‹è¯•
TEST_MODE=false
```

#### 2. ç”¨æˆ·ç«¯åº”ç”¨ (yeslocker-app)

```bash
# APIé…ç½®
VITE_API_BASE_URL=https://api.yes147.net
VITE_APP_TITLE=YesLocker

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_MOCK=false
VITE_DEBUG_MODE=false

# åº”ç”¨ä¿¡æ¯
VITE_APP_VERSION=1.0.0
```

#### 3. ç®¡ç†ç«¯åº”ç”¨ (yeslocker-admin)

```bash
# APIé…ç½®
VITE_API_BASE_URL=https://api.yes147.net
VITE_APP_TITLE=YesLockerç®¡ç†å¹³å°

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_MOCK=false
VITE_DEBUG_MODE=false

# åº”ç”¨ä¿¡æ¯
VITE_APP_VERSION=1.0.0
```

#### 4. PostgreSQL æ•°æ®åº“

Railway ä¼šè‡ªåŠ¨ä¸º PostgreSQL æœåŠ¡åˆ›å»ºä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
DATABASE_URL=postgresql://postgres:password@host:5432/railway
PGDATABASE=railway
PGHOST=containers-us-west-xx.railway.app
PGPASSWORD=password
PGPORT=5432
PGUSER=postgres
```

è¿™äº›å˜é‡ä¼šè‡ªåŠ¨æ³¨å…¥åˆ°è¿æ¥çš„æœåŠ¡ä¸­ã€‚

## ğŸ”‘ ç¯å¢ƒå˜é‡è¯´æ˜

### é€šç”¨å˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| NODE_ENV | è¿è¡Œç¯å¢ƒ | development / production |
| PORT | æœåŠ¡ç«¯å£ | 3001 |

### æ•°æ®åº“ç›¸å…³

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| DATABASE_URL | PostgreSQLè¿æ¥å­—ç¬¦ä¸² | postgresql://user:pass@host:5432/db |

### è®¤è¯ç›¸å…³

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| JWT_SECRET | JWTç­¾åå¯†é’¥ | éšæœºå­—ç¬¦ä¸²ï¼ˆ32ä½ä»¥ä¸Šï¼‰ |
| JWT_EXPIRES_IN | JWTè¿‡æœŸæ—¶é—´ | 7d |

### çŸ­ä¿¡æœåŠ¡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| TENCENT_SECRET_ID | è…¾è®¯äº‘å¯†é’¥ID | AKIDxxxxxxxx |
| TENCENT_SECRET_KEY | è…¾è®¯äº‘å¯†é’¥ | xxxxxxxx |
| TENCENT_SMS_APP_ID | çŸ­ä¿¡åº”ç”¨ID | 1400xxxxx |
| TENCENT_SMS_SIGN_NAME | çŸ­ä¿¡ç­¾å | YesLocker |
| TENCENT_SMS_TEMPLATE_ID | çŸ­ä¿¡æ¨¡æ¿ID | 123456 |

### å‰ç«¯ç›¸å…³

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| VITE_API_BASE_URL | APIåŸºç¡€åœ°å€ | https://api.yes147.net |
| VITE_APP_TITLE | åº”ç”¨æ ‡é¢˜ | YesLocker |
| VITE_ENABLE_MOCK | å¯ç”¨æ¨¡æ‹Ÿæ•°æ® | false |
| VITE_DEBUG_MODE | è°ƒè¯•æ¨¡å¼ | false |

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **å¯†é’¥ç®¡ç†**
   - ä½¿ç”¨å¼ºå¯†ç ç”Ÿæˆå™¨ç”Ÿæˆ JWT_SECRET
   - ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒä½¿ç”¨ä¸åŒçš„å¯†é’¥
   - å®šæœŸè½®æ¢å¯†é’¥

2. **ç¯å¢ƒéš”ç¦»**
   - ä¸è¦å°†ç”Ÿäº§ç¯å¢ƒçš„å¯†é’¥æäº¤åˆ°ä»£ç åº“
   - ä½¿ç”¨ `.gitignore` æ’é™¤æ‰€æœ‰ `.env` æ–‡ä»¶
   - åœ¨ Railway ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†

3. **è®¿é—®æ§åˆ¶**
   - é™åˆ¶å¯¹ç”Ÿäº§ç¯å¢ƒå˜é‡çš„è®¿é—®æƒé™
   - ä½¿ç”¨æœ€å°æƒé™åŸåˆ™
   - è®°å½•æ‰€æœ‰ç¯å¢ƒå˜é‡çš„ä¿®æ”¹

## ğŸ”§ ç¯å¢ƒå˜é‡ä½¿ç”¨

### åœ¨ Node.js ä¸­ä½¿ç”¨

```javascript
// åŠ è½½ç¯å¢ƒå˜é‡
require('dotenv').config();

// ä½¿ç”¨ç¯å¢ƒå˜é‡
const port = process.env.PORT || 3001;
const dbUrl = process.env.DATABASE_URL;
```

### åœ¨ Vite/Vue ä¸­ä½¿ç”¨

```typescript
// è®¿é—®ç¯å¢ƒå˜é‡
const apiUrl = import.meta.env.VITE_API_BASE_URL;
const appTitle = import.meta.env.VITE_APP_TITLE;

// åˆ¤æ–­ç¯å¢ƒ
if (import.meta.env.DEV) {
  // å¼€å‘ç¯å¢ƒ
}
if (import.meta.env.PROD) {
  // ç”Ÿäº§ç¯å¢ƒ
}
```

## ğŸ“ ç¯å¢ƒå˜é‡æ¨¡æ¿

### ç”Ÿæˆå®‰å…¨çš„å¯†é’¥

```bash
# ç”Ÿæˆ JWT_SECRET (Linux/Mac)
openssl rand -base64 32

# ç”Ÿæˆ JWT_SECRET (Node.js)
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

### éªŒè¯ç¯å¢ƒå˜é‡

åˆ›å»ºä¸€ä¸ªè„šæœ¬æ¥éªŒè¯å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š

```javascript
// scripts/check-env.js
const required = [
  'DATABASE_URL',
  'JWT_SECRET',
  'TENCENT_SECRET_ID',
  'TENCENT_SECRET_KEY'
];

const missing = required.filter(key => !process.env[key]);

if (missing.length > 0) {
  console.error('ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š');
  missing.forEach(key => console.error(`  - ${key}`));
  process.exit(1);
}

console.log('âœ… æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡å·²é…ç½®');
```

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

- ç¡®ä¿é‡å¯äº†åº”ç”¨
- æ£€æŸ¥å˜é‡åæ‹¼å†™
- ç¡®è®¤ `.env` æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®

### 2. Railway ç¯å¢ƒå˜é‡

- åœ¨ Railway è®¾ç½®ä¸­æ·»åŠ å˜é‡åéœ€è¦é‡æ–°éƒ¨ç½²
- ä½¿ç”¨ Railway CLI å¯ä»¥æ‰¹é‡è®¾ç½®å˜é‡

### 3. æœ¬åœ°å¼€å‘è¿æ¥è¿œç¨‹æ•°æ®åº“

```bash
# ä½¿ç”¨ Railway çš„æ•°æ®åº“
railway link
railway run npm run dev
```

## ğŸ“š å‚è€ƒé“¾æ¥

- [Railway ç¯å¢ƒå˜é‡æ–‡æ¡£](https://docs.railway.app/develop/variables)
- [Vite ç¯å¢ƒå˜é‡æ–‡æ¡£](https://cn.vitejs.dev/guide/env-and-mode.html)
- [dotenv æ–‡æ¡£](https://github.com/motdotla/dotenv)