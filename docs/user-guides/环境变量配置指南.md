# YesLocker 环境变量配置指南

## 🔐 环境变量概览

本文档详细说明了 YesLocker 系统在不同环境下需要配置的环境变量。

## 📦 开发环境 (Development)

### 用户端 (User App)

创建 `.env.local` 文件在项目根目录：

```bash
# API配置
VITE_API_BASE_URL=http://localhost:3001
VITE_APP_TITLE=YesLocker开发版

# 功能开关
VITE_ENABLE_MOCK=false
VITE_DEBUG_MODE=true
```

### 管理端 (Admin Panel)

创建 `admin/.env.local` 文件：

```bash
# API配置
VITE_API_BASE_URL=http://localhost:3001
VITE_APP_TITLE=YesLocker管理端开发版

# 功能开关
VITE_ENABLE_MOCK=false
VITE_DEBUG_MODE=true
```

### API服务器 (Server)

创建 `server/.env` 文件：

```bash
# 服务器配置
PORT=3001
NODE_ENV=development

# 数据库配置（PostgreSQL）
DATABASE_URL=postgresql://username:password@localhost:5432/yeslocker

# JWT配置
JWT_SECRET=your-development-jwt-secret
JWT_EXPIRES_IN=7d

# CORS配置
CORS_ORIGIN=http://localhost:3000,http://localhost:3002

# 短信服务配置（腾讯云）
TENCENT_SECRET_ID=your-tencent-secret-id
TENCENT_SECRET_KEY=your-tencent-secret-key
TENCENT_SMS_APP_ID=your-sms-app-id
TENCENT_SMS_SIGN_NAME=YesLocker
TENCENT_SMS_TEMPLATE_ID=your-template-id

# 测试模式
TEST_MODE=true
TEST_SMS_CODE=123456
```

## 🚀 生产环境 (Production - Railway)

### Railway 平台环境变量设置

#### 1. API 服务 (yeslocker-api)

在 Railway 的 API 服务设置中添加：

```bash
# 基础配置
NODE_ENV=production
PORT=3001

# 数据库（Railway自动注入）
DATABASE_URL=(Railway会自动提供)

# JWT配置
JWT_SECRET=your-super-secure-production-jwt-secret
JWT_EXPIRES_IN=7d

# CORS配置
CORS_ORIGIN=https://app.yes147.net,https://admin.yes147.net

# 短信服务配置
TENCENT_SECRET_ID=your-production-tencent-secret-id
TENCENT_SECRET_KEY=your-production-tencent-secret-key
TENCENT_SMS_APP_ID=your-production-sms-app-id
TENCENT_SMS_SIGN_NAME=YesLocker
TENCENT_SMS_TEMPLATE_ID=your-production-template-id

# 生产模式关闭测试
TEST_MODE=false
```

#### 2. 用户端应用 (yeslocker-app)

```bash
# API配置
VITE_API_BASE_URL=https://api.yes147.net
VITE_APP_TITLE=YesLocker

# 功能开关
VITE_ENABLE_MOCK=false
VITE_DEBUG_MODE=false

# 应用信息
VITE_APP_VERSION=1.0.0
```

#### 3. 管理端应用 (yeslocker-admin)

```bash
# API配置
VITE_API_BASE_URL=https://api.yes147.net
VITE_APP_TITLE=YesLocker管理平台

# 功能开关
VITE_ENABLE_MOCK=false
VITE_DEBUG_MODE=false

# 应用信息
VITE_APP_VERSION=1.0.0
```

#### 4. PostgreSQL 数据库

Railway 会自动为 PostgreSQL 服务创建以下环境变量：

```bash
DATABASE_URL=postgresql://postgres:password@host:5432/railway
PGDATABASE=railway
PGHOST=containers-us-west-xx.railway.app
PGPASSWORD=password
PGPORT=5432
PGUSER=postgres
```

这些变量会自动注入到连接的服务中。

## 🔑 环境变量说明

### 通用变量

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| NODE_ENV | 运行环境 | development / production |
| PORT | 服务端口 | 3001 |

### 数据库相关

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| DATABASE_URL | PostgreSQL连接字符串 | postgresql://user:pass@host:5432/db |

### 认证相关

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| JWT_SECRET | JWT签名密钥 | 随机字符串（32位以上） |
| JWT_EXPIRES_IN | JWT过期时间 | 7d |

### 短信服务

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| TENCENT_SECRET_ID | 腾讯云密钥ID | AKIDxxxxxxxx |
| TENCENT_SECRET_KEY | 腾讯云密钥 | xxxxxxxx |
| TENCENT_SMS_APP_ID | 短信应用ID | 1400xxxxx |
| TENCENT_SMS_SIGN_NAME | 短信签名 | YesLocker |
| TENCENT_SMS_TEMPLATE_ID | 短信模板ID | 123456 |

### 前端相关

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| VITE_API_BASE_URL | API基础地址 | https://api.yes147.net |
| VITE_APP_TITLE | 应用标题 | YesLocker |
| VITE_ENABLE_MOCK | 启用模拟数据 | false |
| VITE_DEBUG_MODE | 调试模式 | false |

## 🛡️ 安全建议

1. **密钥管理**
   - 使用强密码生成器生成 JWT_SECRET
   - 生产环境和开发环境使用不同的密钥
   - 定期轮换密钥

2. **环境隔离**
   - 不要将生产环境的密钥提交到代码库
   - 使用 `.gitignore` 排除所有 `.env` 文件
   - 在 Railway 中使用环境变量管理

3. **访问控制**
   - 限制对生产环境变量的访问权限
   - 使用最小权限原则
   - 记录所有环境变量的修改

## 🔧 环境变量使用

### 在 Node.js 中使用

```javascript
// 加载环境变量
require('dotenv').config();

// 使用环境变量
const port = process.env.PORT || 3001;
const dbUrl = process.env.DATABASE_URL;
```

### 在 Vite/Vue 中使用

```typescript
// 访问环境变量
const apiUrl = import.meta.env.VITE_API_BASE_URL;
const appTitle = import.meta.env.VITE_APP_TITLE;

// 判断环境
if (import.meta.env.DEV) {
  // 开发环境
}
if (import.meta.env.PROD) {
  // 生产环境
}
```

## 📝 环境变量模板

### 生成安全的密钥

```bash
# 生成 JWT_SECRET (Linux/Mac)
openssl rand -base64 32

# 生成 JWT_SECRET (Node.js)
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

### 验证环境变量

创建一个脚本来验证必需的环境变量：

```javascript
// scripts/check-env.js
const required = [
  'DATABASE_URL',
  'JWT_SECRET',
  'TENCENT_SECRET_ID',
  'TENCENT_SECRET_KEY'
];

const missing = required.filter(key => !process.env[key]);

if (missing.length > 0) {
  console.error('缺少必需的环境变量：');
  missing.forEach(key => console.error(`  - ${key}`));
  process.exit(1);
}

console.log('✅ 所有必需的环境变量已配置');
```

## 🚨 常见问题

### 1. 环境变量未生效

- 确保重启了应用
- 检查变量名拼写
- 确认 `.env` 文件在正确位置

### 2. Railway 环境变量

- 在 Railway 设置中添加变量后需要重新部署
- 使用 Railway CLI 可以批量设置变量

### 3. 本地开发连接远程数据库

```bash
# 使用 Railway 的数据库
railway link
railway run npm run dev
```

## 📚 参考链接

- [Railway 环境变量文档](https://docs.railway.app/develop/variables)
- [Vite 环境变量文档](https://cn.vitejs.dev/guide/env-and-mode.html)
- [dotenv 文档](https://github.com/motdotla/dotenv)